# 6장 브랜치

## 6.1 새로운 작업

### 6.1.1 브랜치 작업

-   커밋은 파일의 수정 이력을 관리하는 데 사용한다면, 브랜치는 프로젝트를 독립적으로 관리하는 데 사용한다.

### 6.1.2 깃 브랜치 특징

-   가상 폴더
-   독립적인 동작
-   빠른 동작
    -   깃은 Blob 개념을 도입하여 내부를 구조화한다. Blob은 포인트와 유사한 객체. 깃은 브랜치를 변경할 때 포인터를 이동하여 빠르게 전환한다.
    -   브랜치 명령을 사용하면 내부적으로 커밋을 하나 생성하여 브랜치로 할당한다. 깃은 41바이트를 가지는 해시(SHA1) 파일 하나만 만들면 된다. 따라서 브랜치를 빠르게 생성할 수 있다.

---

## 6.2 실습 준비

-   깃은 기본적으로 master 브랜치를 하나 가지고 있다. 그리고 브랜치는 HEAD 포인터를 가지고 있다.

### 6.2.2 기본 브랜치

-   깃은 최소한 브랜치가 1개 이상 필요하다. 따라서 저장소를 처음 초기화하면 master 브랜치가 자동으로 생성된다.

    ```
    $ git status
    현재 브랜치 master

    아직 커밋이 없습니다

    커밋할 사항 없음 (파일을 만들거나 복사하고 "git add"를 사용하면 추적합니다)

    ```

---

## 6.3 브랜치 생성

-   브랜치는 공통의 커밋을 가리키는 지점. 브랜치는 커밋처럼 SHA1 해시키를 가리킨다.
    하지만 커밋의 SHA1 해시키를 기억하기가 어렵기 때문에 특정 커밋을 가리키는 별칭을 만든 것이다. 이렇게 만든 별칭이 브랜치이다.
    즉 브랜치를 생성한다는 의미는 기본 브랜치 또는 커밋에 새로운 연결 고리를 하나 더 만드는 것과 같다.
-   새 브랜치를 생성하면 포인터만 있는 브랜치가 생성된다. 일반적으로 브랜치 생성 명령을 실행하면 현재 키멋을 가리키는 HEAD를 기준으로 생성된다. HEAD는 현재 마지막 커밋을 가리킨다.
-   브랜치는 마지막 커밋 위치를 가리키는 역할만 할 뿐 실제 브랜치는 아니다. 일반적으로 실제 커밋이 추가될 때 실제 커밋이 만들어진다.

### 6.3.1 브랜치 생성

```
$ git branch 브랜치이름 커밋ID
```

### 6.3.2 브랜치 이름

-   해당 브랜치 작업을 알기 쉬운 이름으로 짓는 것이 좋다. 또는 깃 플로(git flow)에서 정의한 브랜치 이름을 적용하는 것도 좋은 방법.
-   작성 규칙
    -   기호(-)로 시작할 수 없다.
    -   마침표(.)로 시작할 수 없다.
    -   연속적인 마침표(..)를 포함할 수 없다.
    -   빈칸, 공백 문자, 물결(~), 캐럿(^), 물음표(?), 별표(\*), 대괄호([]) 등은 포함할 수 없다.
    -   아스키 제어 문자 포함할 수 없다.

### 6.3.3 소스트리 브랜치

---

## 6.4 브랜치 확인

### 6.4.1 간단 브랜치 목록

-   branch 명령어는 단독으로 사용할 수 있다.

    ```
    $ git branch
    ```

-   별표(\*)는 현재 선택된 브랜치를 의미한다. 소스트리 목록에서는 ○ 마크로 현재 브랜치 표시

### 6.4.2 브랜치 해시

-   브랜치는 특정한 커밋의 해시 값(SHA1)을 가리킨다. 깃의 저수준 명령어인 rev-parse를 사용하면 현재 브랜치가 어떤 커밋 해시 값(SHA1)을 가리키는지 확인할 수 있다.

    ```
    $ git rev-parse 브랜치이름
    ```

### 6.4.3 브랜치 세부사항 확인

-   -v 또는 -verbose(뜻 : 말 수가 많은) 옵션을 함께 사용하면 브랜치 이름, 커밋 ID, 커밋 메시지를 같이 볼 수 있다.

    ```
    $ git branch -v
    ```

---

## 6.5 브랜치 이동

### 6.5.1 체크아웃

-   현재 브랜치를 떠나 새로운 떠나 새로운 브랜치로 들어간다.

    ```
    $ git checkout 브랜치이름
    ```

-   깃은 하나의 워킹 디렉토리만 가지고 있다. 워킹 디렉토리는 선택한 브랜치 하나만 연결되어 있다. 브랜치를 변경하여 워킹 디렉토리를 재설정해야 한다.
-   워킹 디렉토리에 커밋하지 않은 내용이 있다면 브랜치를 변경할 수 없다.
-   체크아웃은 브랜치 외에 특정 커밋이나 파일로도 할 수 있다.
    ```
    $ git checkout 브랜치이름
    $ git checkout -- 파일이름
    ```
    이중 대시(--)를 사용하면 파일 이름을 정확히 지정하여 브랜치를 변경할 수 있다.

### 6.5.2 브랜치 동작 원리

checkout 명령어로 브랜치가 변경되면 깃은 내부적으로 몇 가지 동작을 수행한다.

-   HEAD 정보는 항상 변경된 브랜치의 마지막 커밋을 가리킨다. 이처럼 HEAD가 브랜치의 마지막 커밋을 의미하기 때문에 브랜치가 이동하면 HEAD 포인터도 함께 이동한다.
-   변경된 브랜치로 새로운 작업을 할 수 있도록 워킹 디렉토리를 변경한다. 브랜치를 변경하려면 기존 브랜치의 워킹 디렉토리를 정리해야 한다. 기존 브랜치의 워킹 디렉토리르 정리하지 않고서는 브랜치를 변경할 수 없다.

### 6.5.3 소스트리

### 6.5.4 이전 브랜치

-   리눅스에서 대시(-) 기호는 이전 디렉토리를 의미한다.
    ```
    $ git checkout -
    ```

### 6.5.5 워킹 디렉토리 정리

-   체크아웃을 사용하여 브랜치를 이동할 때 현재 작업하고 있는 워킹 디렉터리를 정리하고 넘어가야 한다.
-   깃은 향후 충돌을 방지하려고 워킹 디렉토리에 작업이 남아 있다면 경고 메시지를 보여주고 브랜치를 변경할 수 없게 제한한다.
-   작업된 워킹 디렉터리를 커밋하지 않고 브랜치를 변경할 때는 스태시 기능을 이용하면 좋다. -> 7장

---

## 6.6 브랜치 공간

브랜치와 워킹 디렉터리가 어떤 관계가 있는지 알아본다.

### 6.6.1 브랜치 로그

-   현재까지 작업한 로그 기록 확인. 로그를 출력할 때 브랜치 흐름도 같이 보려면 --graph 옵션을 함께 사용한다. --graph --all 옵션을 사용하면 모든 로그를 출력한다.
    ```
    $ git log --graph --all
    ```
-   --more 옵션으로 출력될 커밋 개수를 제한할 수 있다.
    ```
    $ git show-branch --more=10
    ```

### 6.6.2 브랜치 소스 확인

-   동영상 파일 : 6-11\_브랜치 소스 확인.mov

---

## 6.7 HEAD 포인터

-   깃은 객체의 포인터 개념을 사용한다. 대표적인 객체 포인터는 HEAD.

### 6.7.1 마지막 커밋

-   깃은 마지막 커밋 정보가 중요한다. 깃은 마지막 커밋 정보를 기반으로 새로운 커밋을 생성한다. 마지막 커밋은 새로운 커밋의 부모 커밋이다.
-   시스템이 매번 커밋할 때마다 마지막 커밋 정보를 찾으면 부하가 발생한다. 깃은 마지막 커밋을 쉽게 확인할 수 있도록 특수한 포인터를 제공한다. HEAD는 작업 중인 브랜치의 마지막 커밋 ID를 가리키는 참조 포인터다.
-   깃은 마지막 커밋을 가리키는 HEAD 포인터를 부모 커밋으로 대체하여 사용한다. HEAD 포인터를 사용하여 빠르게 스냅샷을 생성할 수 있다.
-   동영상 파일 : 6-12\_마지막 커밋.mov

### 6.7.2 브랜치 HEAD

-   브랜치를 이동하면 HEAD 포인터도 이동된다. 브랜치가 여러 개면 HEAD 포인트도 여러 개다. 각각의 브랜치마다 마지막 커밋이 다르기 때문이다. 브랜치마다 마지막 커밋 ID를 가리키는 HEAD 포인터가 하나씩 있다.
-   HEAD 포인터는 브랜치에 따라서 위치가 달라진다. HEAD는 현재 작업하는 브랜치를 가리키기 때문이다.

### 6.7.3 소스트리 HEAD

-   동영상 파일 : 6-13\_소스트리 HEAD.mov

### 6.7.4 상대적 위치

-   상대적 커밋 위치를 지정할 대는 캐럿(^)과 물결(~) 기호를 같이 사용. ^과 ~은 HEAD를 기준으로 몇 번째인지 상대적인 위치를 지정한다.
-   HEAD 포인터 바로 이전의 커밋을 가리킨다면 HEAD^ 또는 HEAD~
-   HEAD를 기준으로 이전 3개의 위치를 지정하고 싶다면 HEAD^^^ 또는 HEAD~~~, HEAD^3, HEAD~3

### 6.7.5 AHEAD, BHEAD

-   원격 저장소와 연동하여 깃을 관리하면 브랜치마다 HEAD가 2개씩 있다. 로컬 저장소 브랜치의 HEAD 포인터와 원격 저장소 브랜치의 HEAD 포인터다.
-   원격 저장소와 로컬 저장소는 물리적으로 서로 다른 저장소다. 따라서 두 저장소의 마지막 커밋 위치가 일치하지 않을 수 있다. 이는 서로 다른 커밋을 가리키는 HEAD 포인터를 가진다는 의미다.
-   AHEAD와 BHEAD는 서로 다른 저장소 간 HEAD 포인터의 위치 차이를 의미한다. 깃은 항상 원격 저장소의 HEAD와 로컬 저장소의 HEAD를 비교한다.

#### AHEAD

-   서버로 전송되지 않은 로컬 커밋이 있는 것
-   로컬 저장소의 HEAD 포인터를 기준으로 로컬 브랜치에 있는 커밋이 서버의 커밋 개수보다 많은 경우

#### BHEAD

-   로컬 저장소로 내려받지 않은 커밋이 있는 것
-   다른 개발자가 코드를 수정하여 원격 저장소의 커밋이 자신의 로컬 저장소보다 더 최신 상태인 것

---

## 6.8 생성과 이동

### 6.8.1 자동 이동 옵션

-   브랜치 생성와 이동 명령을 한꺼번에 처리하는 옵션
-   체크아웃할 때 -b 옵션을 사용하면 브랜치 생성과 이동을 한번에 할 수 있다.
    ```
    $ git checkout -b 브랜치이름
    ```
-   동영상 파일 : 6-14\_자동 이동 옵션.mov

### 6.8.2 커밋 이동

-   브랜치는 특정한 커밋에 별명을 부여한 것과 같다. 브랜치를 생성할 대는 마지막 커밋을 기준으로 한다. 그리고 커밋 해시 값을 지정한 별칭으로 브랜치 목록에 등록한다.
-   브랜치 이름은 커밋 해시키와 동일하다. 브랜치로 이동할 때 브랜치 이름 대신 커밋 해시키를 사용하여 체크아웃 할 수 있다.
    ```
    $ git checkout 커밋해시키
    ```
-   동영상 파일 : 6-15\_커밋 이동.mov

### 6.8.3 HEAD를 활용한 이동

-   바로 이전 커밋으로 체크아웃하고 싶을 때

    ```
    $ git checkout HEAD~1

    // 5번째 전
    $ git checkout HEAD~5
    ```

-   동영상 파일 : 6-16_HEAD를 활용한 이동.mov

### 6.8.4 돌아오기

-   커밋 해시키 또는 HEAD를 사용하여 과거의 커밋으로 체크아웃했다면 다시 현재 시점으로 돌아와야 한다. 간단하게 돌아오는 방법은 대시(-)를 사용한다.
    ```
    $ git checkout -
    ```
-   동영상 파일 : 6-17\_돌아오기.mov

---

## 6.9 원격 브랜치

### 6.9.1 리모트 브랜치

-   별도 명령을 통해 저장소를 동기화해야 한다.
-   서로 다른 이름으로 브랜치를 연결할 수도 있다.
-   리모트 브랜치는 보통 별칭/브랜치 이름 형태이다.

### 6.9.2 실습 준비

-   6-18\_원격 저장소 연결.mov

### 6.9.3 브랜치 추적

-   원격 저장소의 브랜치를 가리키는 것을 브랜치 추적이라고 한다.
-   트래킹 브랜치라고도 한다. 원격 브랜치를 가리키는 북마크와 같다.
-   추적 브랜치는 마지먹 커밋 해시 값을 가리킨다. 이 포인터 정보는 .git/refs 폴더 안에 저장되어 있다.
-   6-19\_브랜치 추적.mov

### 6.9.4 브랜치 업로드

-   등록된 원격 저장소의 브랜치 정보는 remote show 명령어로 확인할 수 있다.
    ```
    $ git remoate show origin
    ```
-   로컬 저장소의 브랜치를 원격 저장소에 동기화하려면 푸시 작업을 해야 한다.
    ```
    $ git push 원격저장소별칭 브랜치이름
    ```
-   6-20\_브랜치 업로드.mov

### 6.9.5 이름이 다른 브랜치

-   반드시 이름이 동일할 필요 없다.

    ```
    $ git push origin 브랜치이름:새로운브랜치
    ```

-   6-21\_이름이 다른 브랜치.mov

### 6.9.6 업스트림(upstream) 트래킹

-   업스트림은 브랜치 추적을 다르게 표현한 것
-   로컬 저장소의 브랜치와 원격 저장소의 브랜치는 업로드 할 수 있도록 매칭되어 있다. 이러한 매칭을 업스트림 트래킹이라고 한다.
-   트래킹 브랜치(업스트림)는 리모트 브랜치와 로컬 브랜치를 연결해 주는 중간 다리 역할
-   clone 명령어로 저장소를 복제할 때 원격 저장소에 등록된 트래킹 브랜치들을 자동으로 함께 설정한다.
    -   [Note] clone을 복제할 때는 생성 폴더의 이름을 지정하지 않으면, 깃허브의 저장소 이름과 동일한 폴더로 저장소가 생성된다. 다른 이름으로 복제할 때는 이름을 지정한다.
    -   clone 명령어는 원격 저장소의 모든 브랜치 정보를 한 번에 다 가져오지 않는다.
-   -r 옵션 : 원격 저장소의 리모트 브랜치 목록을 확인할 수 있다.
    ```
    $ git branch -r
    ```
-   -a 옵션 : 모든 브랜치 정보 확인
    ```
    $ git branch -a
    ```
-   저장소를 복제하면 원본과 동일한 트래킹 브랜치가 자동으로 설정된다. 트래밍 브랜치는 -vv옵션을 사용
    ```
    $ git branch -vv
    * master 222989c [origin/master] master working
    ```
    -   복제한 저장소는 트래킹 브랜치만 하나 표시된다. clone 명령어로 복제할 때 모든 브랜치를 한 번에 복제하지 않기 떄문. 효율성을 위해 불필요한 브랜치를 한 번에 다 가져오지 않는다.
-   여기까지 동영상 : 6-22\_업스트림 트래킹\_clone.mov

-   새로운 업스트림
    ```
    $ git checkout --track origin/브랜치이름
    ```
-   동영상 : 6-23*업스트림 트래킹*새로운 업스트림.mov

### 6.9.7 원격 브랜치 복사

-   다른 개발자가 생성한 원격 저장소의 리모트 브랜치를 이용해서 로컬 저장소에도 새로운 브랜치를 생성하여 동기화 할 수 있다.
    ```
    $ git checkout -b 새이름 origin/브랜치이름
    ```
-   동영상 : 6-24\_원격 브랜치 복사.mov

### 6.9.8 업스트림 연결

-   기존에 있는 브랜치를 업스트림으로 직접 설정할 수 있다. 브랜치를 생성한 후 직접 트래킹 브랜치를 지정했다. 업스트림을 직접 설정하면 원격 저장소로 트래킹 브랜치가 설정된다.
    ```
    $ git branch -u origin/브랜치이름
    ```
    -   -u 옵션: --set-upstream-to의 약자
    -   기존 브랜치를 특정 원격 브랜치로 추적
-   동영상 : 6-25\_업스트림 연결.mov

---

## 6.10 브랜치 전송

로컬 저장소의 브랜치를 원격 저장소로 전송하는 다른 방법을 살펴본다.

### 6.10.1 브랜치 푸시

-   깃의 푸시 작업은 로컬 저장소의 파일들을 원격 저장소로 전송한다. 파일뿐만 아니라 브랜치 정보와 커밋까지 모두 전송한다.
-   원격 저장소 연결만으로 업스트림이 자동으로 설정되지 않는다.
-   처음 푸시 작업을 하면 깃은 사용자에게 업스트림이 설정되지 않았다는 오류 메시지를 출력한다.
    ```
    $ git push --set-upstream origin master
    ```

### 6.10.2 브랜치 페치

-   리모트 브랜치 패치는 일반적인 커밋 페치와 동일하다. 리모트 브랜치를 페치한다고 해서 자동으로 로컬 저장소에 새로운 브랜치가 생성되지는 않는다. 페치 동작은 원격 저장소에서 리모트 브랜치 내용을 내려받기만 할 뿐이지 자동으로 병합하지 않는다.
-   리모트 브랜치가 패치되면 깃은 원격저장소별칭/브랜치 포인터만 생성한다. 원격 저장소에서 페치된 커밋들을 새로운 로컬 브랜치로 반영하려면 병합 명령을 실행해야 한다.
    ```
    $ git merge 원격저장소별칭/브랜치이름
    ```
-   페치된 브랜치를 병합하지 않고 테스트만 하고 싶을 때. 원격 브랜치의 포인터를 사용하여 임시 브랜치를 생성하거나 직접 체크아웃할 수 있다.
    ```
    $ git checkout -b 임시브랜치이름 origin/브랜치이름
    ```

---

## 6.11 브랜치 삭제

-   삭제하고자 할 때는 다른 브랜치로 이동해서 삭제

### 6.11.1 일반적인 삭제 방법

-   -d 옵션
    ```
    $ git branch -d 브랜치이름
    ```
    -   -d 옵션은 반드시 최종 상태가 커밋되어 스테이지 상태가 깨끗할 때만 삭제를 허용
-   6-26\_브랜치 삭제.mov

### 6.11.2 강제로 삭제하는 방법

-   워킹 디렉토 또는 스테이지에 추가 커밋 작업이 남아 있다면 강제로 삭제해야 한다.
    ```
    $ git branch -D 브랜치이름
    ```
-   6-27\_강제 브랜치 삭제.mov

### 6.11.3 소스트리에서 삭제하는 방법

-   6-28\_소스트리 브랜치 삭제.mov

### 6.11.4 리모트 브랜치를 삭제하는 방법

-   원격 브랜치를 삭제하려면 삭제 명령을 푸시
    ```
    $ git push origin --delete 리모트브랜치이름
    ```
-   원격 저장소의 브랜치를 삭제하면 리모트 브랜치에 기록된 커밋도 모두 삭제된다.
-   6-29\_리모트 브랜치 삭제.mov

---

## 6.12 정리
