# 7장 임시 처리

<br>

## 7.1 스태시

<br>

-   stash
    -   뜻: 숨기는 장소
    -   "안전한 보관"
-   깃은 완료지지 않은 작업(커밋되지 않은 변경 내용)이 남아 있을 때, 현재 작업을 임시로 저장할 수 있는 스태시 기능을 제공한다.
-   스태시는 '현재 워킹 디렉토리 내역을 별도의 스텍 영역에 잠시 보관하라'는 명령이다.

```
$ git stash --help
```

<br>

### 7.1.1 기존 작업 도중에 새로운 변경 요청

<br>

### 7.1.2 새 코드 작성 중 기존 코드를 수정

<br>

### 7.1.3 스태시의 임시 스택 영역에 작업 중인 코드 저장

-   명령어

    ```
    $ git stash
    ```

-   save 명령어를 추가하여 사용, 스태시 여러 개를 생성할 때 유용

    ```
    $ git stash save
    ```

-   스태시는 스택 구조로 여러 번 실행하여 저장할 수 있따. 스태시가 여러 개 있을 때 가각의 스태시를 구별할 수 있도록 메시지도 추가

    ```
    $ git stash save "WIP: 메시지 ~~~"
    ```

    -   WIP : Work In Progress

-   --keep-index 옵션 : 스테이지 영역의 파일들을 제외하고 스태시를 만든다.

-   --include-untracked 옵션 : 등록되지 않은 untracked 상태의 파일을 스태시로 생성

-   7-2_stash.mov

<br>

### 7.1.4 임시 저장 영역의 스택 목록

-   스태시의 저장 영역은 스택 구조
    -   스택은 FILO(First Input Last Out), 마지막 입력한 자료가 제일 먼저 출력되는 데이터 저장 방식
-   스태시에 저장된 스택은 list 옵션을 사용하여 확인
    ```
    $ git stash list
    stash@{0}: WIP on feature: fc8c21d new feature 1
    ```
    -   스태시 이름은 stash@{번호} 형태로 순차적으로 부여된다.
-   깃은 스태시된 객체들을 .git/refs/stash에 저장한다.
    ```
    $ cat .git/refs/stash
    ```
-   스태이시를 실행한 후 방금 전의 스태시와 현재 워킹 디렉터리 간 차이 확인
    ```
    $ git stash show
    ```
-   -p 옵션을 추가하면 상세 차이점을 알 수 있다.
    ```
    $ git stash show -p stash@{0}
    ```
-   7-3\_임시 저장 영역의 스택 목록.mov

<br>

### 7.1.5 임시 저장한 스태시 불러오기

-   스태시에 임시 저장한 내용을 읽어 다시 적용
    ```
    $ git stash pop
    ```
-   제일 마지막에 저장된 내용을 먼저 읽어온다.
-   워킹 디렉터리에 자동으로 병합한다. 자동 병합이 성공하면 읽어 온 내용을 스택에서 제거한다.
-   스태시는 스택에 저장할 때 워킹 디렉터리와 스테이지 영역의 파일까지 모두 보관한다. 스태시로 복원할 때는 워킹 디렉터리만 되돌린다. 스테이지에 등록된 스테시 상태까지 복구하길 원한다면 --index 옵션을 사용해야 한다.
    ```
    $ git stash apply --index
    ```
-   7-4\_임시 저장한 스태시 불러오기.mov

<br>

### 7.1.6 스태시 복원으로 충돌

-   복원하는 도중 충돌이 생기면 스테시는 스택에 저장된 내용을 자동으로 삭제하지 않습니다.
-   스태시 스택에 저장된 내용으로 새로운 브랜치를 동시에 생성할 수 있다.
    ```
    $ git stash branch 브랜치이름
    ```
-   정상으로 스태시 복원이 적용되면 저장된 스택은 자동으로 삭제
-   [Note] 스태시는 원격 저장소와 연결하여 작업할 때 충돌하는 상황에도 사용할 수 있다.
-   7-5\_스태시 복원으로 충돌.mov

<br>

### 7.1.7 스태시 복사

-   스태시를 사용한 저장과 복원은 서로 다른 브랜치에도 가능하다. 반드시 이전에 실행한 브랜치와 같은 브랜치에서 할 필요는 없다.
-   스태시 스택에 저장된 항목들은 어느 브랜치에서나 복원이 가능하다. apply 옵션은 스택에 저장된 항목을 불러와 현재 브랜치로 복원한다.
    ```
    $ git stash apply
    ```
-   pop
    -   스택 내용을 복원한 후 스택 목록에서 자동으로 삭제
    -   스태시 내용을 워킹 디렉터리로 이동하는 것과 같다.
-   apply
    -   스택 목록을 읽은 후 자동으로 삭제하지 않아 반복적으로 내용을 읽어올 수 있다.
    -   스태시 내용을 워킹 디렉터리로 복사하는 것과 같다.
    -   스택 목록의 중간 작업을 지정하여 적용할 수 있다.
    ```
    $ git stash apply stash@{1}
    ```
-   7-6.스태시 복사.mov

<br>

### 7.1.8 스태시 삭제

```
$ git stash drop
```

<br>

### 7.1.9 소스트리에서 스태시 사용

-   소스트리에서는 코드 파일을 수정한 후 커밋하지 않는 내용이 있는 상태가 되면 자동으로 스태시 버튼이 활성화된다.
-   스태시 메시지는 한글로 작성하면 오류가 생길 수 있으므로 간략하게 영문이나 숫자로 작성한다.
-   7-8\_소스트리에서 스태시 사용.mov

<br>

---

<br>

## 7.2 워킹 디렉토리 청소

<br>

-   개발하는 과정에서 컴파일 등 임시로 생성되는 파일들이 생긴다. .gitignore 목록에 넣어 관리할 수도 있지만, 반복해서 불필요하게 생성되는 파일들은 귀찮다.
-   clean 명령어를 실행하는 순간 워킹 디렉터리의 추적되지 않는 모든 파일을 삭제한다.

```
$ git clean
$ git clean --help
```

-   -f 옵션 : 추적하지 않는 파일들을 강제 삭제
-   -n 옵션 : clean 명령어를 사용하여 잘못 삭제하는 것을 미연에 방지하고자 파일을 가상으로 미리 처리해보고 사용자에게 확인을 요청한다.
-   -d 옵션 : 워킹 디릭터리를 삭제하는 과정에서 새롭게 생성된 파일, 즉 추적되지 않는 파일만 별도로 삭제. untracked 상태의 파일만 삭제. 이 옵션으로 잘 삭제되지 않는다면 강세 수행 옵션인 -f를 같이 사용할 수도 있다.
-   x 옵션 : clean 명령어를 수행할 때 .gitignore에 등록한 파일은 삭제하지 않는다. 이 파일까지 삭제하고 싶다면 -x 옵션 사용
-   Note : 깃에 저장된 것을 완벽히 삭제하기는 쉽지 않다. 깃은 실수로 변경하거나 삭제되는 것을 방지하는 도구이다. 따라서 좀 더 완벽하게 깃 저장소를 청소하려면 깃의 원리를 이해해야 한다. 커밋 기록을 완벽하게 제거하고 싶다면 reflog 기록도 같이 삭제해야 한다.

-   7-9\_워킹 디렉토리 청소.mov

<br>

---

<br>

## 7.3 정리
