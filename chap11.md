# 11장

<br>

## 11.1 대형 프로젝트

<br>

### 11.1.1 저장 용량

-   깃 호스팅 서비스들은 제공되는 용량을 제한한다. 보통 1GB 용량을 제공하기 때문에 파일 개수가 많은 프로젝트에서는 좀 더 효율적인 관리 방법이 필요하다.

<br>

### 11.1.2 저장소 분리

-   저장소 하나를 작은 저장소 몇 개로 분할할 수 있다. 이러한 저장소의 분할 개념을 서브모듈이라고 한다.
-   서브모듈은 저장소 하나가 다른 깃 저장소를 포함하는 형태를 의미한다.
-   작게 나뉜 모듈 형태의 저장소는 다른 프로젝트에서 재사용할 수 있다.

<br>

### 11.1.3 상하 관계

-   보통 부모와 저장소와 자식 저장소 형태로 나눈다.
-   부모 자식 관계로 분리된 로컬 저장소는 또다시 개별 원격 저장소와 연결된다.
-   원격 저장소로 동기화된 자식들은 언제든지 다른 프로젝트의 모듈별로 기능을 처리하고 결합할 수 있다.

<br>

---

<br>

## 11.2 실습을 위한 저장소 준비

-   11-1\_실습 준비.mov

<br>

---

<br>

## 11.3 서브모듈 추가

-   서브모듈은 2개 이상인 저장소를 부모와 자식 관계로 연결한다.
-   저장소를 모듈로 연결하려면 submodule 명령어를 사용한다.
    ```
    $ git submodule -help
    ```

<br>

### 11.3.1 저장소 연결

-   메인 저장소에서 자식 저장소를 추가하는 옵션은 add 명령어
-   서브모듈로 저장소가 추가되면 저장소는 서브 저장소를 서브 폴더 형태로 취급한다.
    ```
    $ git submodule add 원격저장소URL 폴더이름
    ```
-   11-2\_저장소 연결.mov

<br>

### 11.3.2 설정 파일

-   처음으로 메인 저장소에 서브모듈이 등록되면 깃은 루트 위치에 설정 파일 .gitmodules 을 생성한다. 설정 파일은 메인 저장소와연결된 자식 저장소들을 관리한다.
    ```
    $ cat .gitmodules
    [submodule "child"]
    path = child
    url = git@github.com:thegicode/gitstudy_child.git
    ```
    -   환경 설정에는 서브모듈 이름과 URL이 기록되어 있다.
-   11-3\_설정 파일.mov

<br>

### 11.3.3 모듈 커밋

-   서브모듈이 추가된 부모 저장소의 상태를 확인. status 명령어

    ```
    $ git status
    현재 브랜치 master
    브랜치가 'origin/master'에 맞게 업데이트된 상태입니다.

    커밋할 변경 사항:
    (use "git restore --staged <file>..." to unstage)
    새 파일: .gitmodules
    새 파일: child

    ```

-   메인 저장소와 서브모듈인 자식 저장소간 관계를 지속적으로 유지하려면 추가된 정보들을 계속 가지고 있어야 한다. 메인 저장소가 자식들의 정보를 계속 가지려먼 이를 커밋하여 저장해야 한다.

    ```
    git add .gitmodules

    git commit -m "add submodule"
    ```

    -   부모 저장소에 .gitmodules를 커밋하여 자식들의 저장소 이력을 관리한다. 서브모듈은 자식들의 관계를 가지는 설정 파일을 포함하여 같이 배포한다.

-   11-4\_모듈 커밋.mov

<br>

---

## 11.4 서브모듈 작업

-   메인 저장소에는 서브 저장소의 연결 정보만 있다. 메인 저장소에 등록된 서브 저장소는 독립된 별도의 저장 공간이다.

<br>

### 11.4.1 모듈 저장소

-   child 폴더 안에 또 다른 숨긴 저장소인 .git 폴더가 있다. 서브 폴더는 서브모듈로 분리한 독립된 깃 저장소다.

    ```
    $ cd child
    $ ls -all
    total 16
    drwxr-xr-x 4 deokim staff 128 7 13 11:00 .
    drwxr-xr-x 7 deokim staff 224 7 13 11:13 ..
    -rw-r--r-- 1 deokim staff 30 7 13 11:00 .git
    -rw-r--r-- 1 deokim staff 26 7 13 11:00 child.html

    ```

-   11-5\_모듈 저장소

<br>

### 11.4.2 모듈 상태

-   모듈로 등록된 자식 저장소(parent/child) 수정
    -   메인 저장소의 상위 폴더에서는 child 폴더만 변경했다고 출력
-   11-6\_모듈 상태.mov

<br>

### 11.4.3 모듈 커밋

-   자식의 서브 폴더 자정소에서 수정한 내용을 커밋
-   11-7\_모듈 커밋.mov

<br>

### 11.4.4 부모 커밋

-   11-8\_부모 커밋.mov

<br>

---

<br>

## 11.5 자식 저장소 갱신

<br>

### 11.5.1 자식 저장소

-   자식 저장소(gitstudy_child)와 메인 저장소(parent/child)에 등록된 저장소는 서로 다른 영역이다.
-   자식 저장소에 연결된 원격 저장소를 이용하여 실제 자식 저장소를 최신 커밋 정보로 갱신해야 한다.

<br>

### 11.5.2 자식 저장소 갱신

-   수정 반영된 커밋들을 실제 자식 저장소(gitstudy_parent)로 가져와야 한다.
-   11-9\_자식 저장소 갱신.mov

<br>

### 11.5.3 자식 저장소 작업

-   이번엔 반대로 실제 자식 저장소에서 코드를 수정하고, 이를 자식 저장소의 원격 저장소를 거쳐 부모 저장소의 서브모듈(parent/child)로 적용
-   11-10\_자식 저장소 작업.mov

<br>

### 11.5.4 부모 저장소 적용

-   11-11\_부모 저장소 적용

<br>

### 11.5.5 부모 저장소 갱신

-   메인 저장소는 서브모듈의 변경 내용을 모니터링하고 있다. 메인 저장소의 서브 폴더 자체를 변경했기 때문에 변경된 내용을 다시 메인 저장소로 커밋해야 한다.
-   11-12\_부모 저장소 갱신.mov

<br>

---

<br>

## 11.6 부모 저장소 복제

-   서브모듈의 저장소를 복제하거나 배포할 때는 부모/자식 관계도 같이 복제해야 한다.

<br>

### 11.6.1 부모 저장소 복제

-   11-13 부모 저장소 복제.mov

<br>

### 11.6.2 모듈 업데이트

-   메인 저장소를 복제할 때는 서브모듈 정보만 같이 복제할 뿐, 실제 하위 저장소는 같이 복제하지 않는다. 서브모듈의 하위 저장소는 직접 명령어를 실행하여 가져와야 한다.
    ```
    $ git submodule init
    $ git submodule update
    ```
-   깃 배시에서 서브 저장소의 브랜치 이름을 주의 깊게 보라. 브랜치 이름이 master가 아닌 a7705...로 되어 있다. 서브모듈을 업데이트할 때는 메인 저장소의 비어 있는 서브모듈 커밋 위치를 리모트 체크아웃한다.

-   11-14\_모듈 업데이트.mov

<br>

---

<br>

## 11.7 부모 저장소 업데이트

<br>

### 11.7.1 부모 업데이트

-   갱신된 메인 저장소 내용을 정기적으로 갱신하여 서브모듈 상태를 최신으로 유지해야 한다.

<br>

### 11.7.2 부모 저장소로 풀

-   메인 저장소를 주기적으로 pull 작업해 주어야 한다.
    ```
    $ git pull origin master
    $ git submodule update
    ```

<br>

---

<br>

## 11.8 정리

-   서브모듈 형태로 코드를 분리하면 다른 프로젝트에서도 모듈을 재상요할 수 있는 장점이 있다. 또 각 모듈을 원격 저장소와 연결해서 협업하여 개발을 진행할 수도 있다.
