# 9장 되돌리기

특정 시점의 상태로 되돌리는 방법

<br>

## 9.1 되돌리기

-   깃에서 코드 작업을 되돌뢰는 방법은 크게 reset과 revert
-   9-1\_실습 준비.mov

<br>

---

<br>

## 9.2 리셋

-   reset은 커밋을 기준으로 이전 코드로 되돌리는 방법, 기록한 커밋을 취소.
-   커밋을 취소하는 만큼 리셋할 때는 신중하게 작업해야 한다.

<br>

### 9.2.1 복귀 시점

-   git log 명령어로 조회

    ```
    $ git log --oneline
    ```

-   캐럿(^)이나 물결(~) 기호를 사용하여 HEAD의 커밋 위치를 지정한다.

    ```

    $ got reset --hard HEAD^^
    ```

<br>

### 9.2.2 reset 명령어

-   특정 커밋의 해시 값 상태로 모든 코드를 복구한다.

    ```
    $ git reset 옵션 커밋ID
    ```

-   reset 명령어에는 세 가지 옵션이 있다.
    -   soft : 스테이지 영역을 포함한 상태로 복원
    -   mixed : 기본 옵션,
    -   hard : 실제 파일이 삭제 되기 이전 상태로 복원
-   soft 옵션과 mixed 옵션 차이는 크게 스테이지 영역과 관련이 있다. hard 옵션은 워킹 디렉토리와 관련이 있다.

<br>

### 9.2.3 soft 옵션

-   가장 낮은 단계의 리셋 동작

    ```
    // 이전 커밋으로 soft 옵션을 사용한 리셋
    $ git reset --soft HEAD~
    ```

-   파일을 수정하고, add 명령어로 스테이지 영역에 올려 커밋을 실행하기 직전의 단계로 되돌린다.
-   스테이지 상태까지 복원하기 때문에 바로 commit 명령어를 실행
-   단순히 HEAD 위치를 이동하는 역할
-   reset --soft 명령어와 체크아웃 명령어는 HEAD 위치를 이동한다는 점에서 동일하지만, 브랜치를 변경하지 않는다는 점에서 차이가 있다.
-   커밋할 때마다 커밋의 해시 값이 변경된다.
-   reset --soft 명령어의 원리를 이용하면 마지막 커밋을 수정할 수 있다. --amend 명령어와 유사한다.
    ```
    $ git commit --amend
    ```
-   9-2_soft 옵션.mov

<br>

### 9.2.4 mixed 옵션

-   reset 명령어의 기본값은 mixed이다.

    ```
    $ git reset --mixed 커밋ID
    $ git reset 커밋ID
    ```

-   스테이지 상태를 제외하고 복원하기 때문에 Unstage 상태가 되어 메시지가 빨간색으로 표시 된다.
-   커밋하려면 add 명령어를 먼저 실행해야 한다.
-   9-3_mixed 옵션.mov

<br>

### 9.2.5 hard 옵션

-   soft 옵션과 hard 옵션은 복귀 커밋 이후의 작업들은 워킹 디렉터리 영역에 남겨두어 다시 수정하거나 커밋할 수 있도록 상태만 변경하는 것이다.
-   hard 옵션은 리셋되는 복귀 시점의 커밋 상태와 해당 커밋의 워킹 디렉터리까지 모두 되돌린다.
-   reset --hard 명령어를 사용한 커밋 이후의 모든 내용은 삭제된다. 주의해서 사용.
-   hard 옵션을 사용하면 워킹 디렉터리 내용도 함께 삭제된다.
-   9-4_hard 옵션.mov

<br>

### 9.2.6 소스트리

-   9-5\_소스트리.mov

<br>

### 9.2.7 커밋 합치기

-   리셋의 soft 옵션은 HEAD를 해당 커밋으로 이동한다. 그리고 원본 내용은 그대로 워킹 디렉터리에 남겨 둔다.

<br>

### 9.2.8 스테이지 리셋

-   스테이지 영역에 등록할 때는 add 명령어
    ```
    $ git add 파일이름
    ```
-   스테이지 영역에서 등록된 파일을 다시 unstage 상태로 만들 때는 reset 명령어를 사용한다.
    ```
    $ git reset 파일이름
    ```
-   파일 이름을 지정하여 리셋하면 해당 파일은 unstage 상태가 된다. 이 명령어는 다음 명령어의 축약
    ```
    $ git reset --mixed HEAD 파일이름
    ```
-   HEAD 대신 다른 커밋 ID를 사용할 수도 있다.
    ```
    $ git reset 커밋ID 파일이름
    ```

<br>

### 9.2.9 작업 취소

-   코드를 수정하는 도중 오류가 생겨 현재 작업을 모두 취소하고 싶을 수 있다. 보통은 워킹 디렉터리에 코드를 수정하고, 수정한 코드는 다시 스테이지 영역에 등록한다.
-   수정 작업을 완전히 취소하려면 워킹 디렉터리와 스테이지 상태를 모두 제거하야 마지막 커밋 상태로 되돌려 놓아야 한다.
-   리셋할 때의 시점을 현재 HEAD를 기준으로 하면 해당 시점의 수정 작업을 모두 삭제할 수 있다.
    ```
    $ git reset --hard HEAD
    ```

<br>

### 9.2.10 병합 취소

-   리셋은 병합된 브랜치도 취소할 수 있다.
-   9-7\_병합 취소.mov

<br>

### 9.2.11 주의할 점

-   저장소를 외부에 공개했거나 공유하고 있다면 주의해서 리셋을 사용해야 한다.

<br>

---

<br>

## 9.3 리버트 revert

-   공개된 저장소에서 이전 상태로 되돌리는 법
-   리버트와 리셋 차이점은 커밋 정보 삭제 여부이다.

<br>

### 9.3.1 취소 커밋

```
$ git revert HEAD
```

-   리셋은 기존 커밋 정보를 삭제하는 반면, 리버트는 기존 커밋을 남겨두고 취소에 대한 새로운 커밋을 생성한다.
-   취소 커밋을 생성할 때는 revert 명령러를 사용한다. 취소 커밋은 지정한 커밋을 삭제하지 않는다. 그 대신 삭제를 위한 새로운 커밋을 생성한다.

-   9-8\_취소 커밋.mov

<br>

### 9.3.2 리버트 지정

-   리버트는 한 번에 커밋 하나만 취소할 수 있다.
-   직전의 커밋이 아닌 다른 커밋을 취소할 때는
    ```
    $ git revert 커밋ID
    ```
-   깃의 범위 지정 연산자를 사용하여 여러 커밋을 리버트할 수도 있다.
    ```
    $ git revert 커밋ID .. 커밋ID
    ```

<br>

### 9.3.3 소스트리에서 리버트

-   9-9\_소스트리에서 리버트.mov

<br>

### 9.3.4 병합

-   리버트를 이용하여 병합한 커밋을 취소할 수 있다. 리셋은 방금 전 실행한 병합만 삭제한다. 하지만 리버트는 시간이 지난 후에도 과거의 병합을 선택하여 취소할 수있다.
-   리버트로 병합을 취소할 때는 --mainline 옵션을 같이 사용할 수 있다.
    ```
    $ git revert --mainline 숫자 병합커밋ID
    ```
    -   리버트로 병합이 취소 상태가 되면 둘 중 한 브랜치로 체크아웃해야 한다.
    -   --mainlne 옵션은 병합을 취소한 후 체크아웃되는 브랜치를 표시한다.
    -   mainlne은 체크아웃으로 되돌아가는 커밋 번호이다.
-   9-10\_병합 취소.mov

<br>

### 9.3.5 리버트 히스토리

-   리버트를 실행하면 새 커밋이 추가되어 커밋 이력이 복잡한다. 어떻게 보면 리셋으로 간단하게 이전 상태로 되돌리는 것이 간편해 보일 수도 있다. 하지만 저장소를 공개했다면 리셋으로 커밋을 삭제하는 것은 협업 차원에서 위험하다. 이때는 리버트가 유용하다.

<br>

---

<br>

## 9.4 정리
